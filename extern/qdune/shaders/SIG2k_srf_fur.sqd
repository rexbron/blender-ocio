# QDSLC version 0.0.1-alpha
surface SIG2k_srf_fur
param uniform color tipcolor 0.519 0.325 0.125
param uniform float end_spec 0.95
param uniform color rootcolor 0.9714 0.9714 0.9714
param uniform float hair_col_var 0.0
param uniform float start_spec 0.3
param uniform float clump_dark_strength 0.0
param uniform float SPEC2 0.003
param uniform float SPEC1 0.01
param uniform float illum_width 180
param varying vector clump_vect 0.0 0.0 0.0
param uniform float hair_length 0.0
param uniform color specularcolor 0.0 0.0 0.0
param uniform float spec_size_fade 0.1
param uniform float var_fade_start 0.005
param uniform float Ka 0.0287
param uniform float var_fade_end 0.001
param uniform float Kd 0.77
param uniform float roughness1 0.008
param uniform float roughness2 0.016
param uniform normal surface_normal 0.0 0.0 0.0
param uniform float Ks 1.285
param uniform float hair_id 0
param uniform color static_ambient 0.057 0.057 0.057
temp uniform float nonspecular
temp varying float Alpha
temp varying normal nSN
temp varying float l
temp varying float Atten
temp varying color Cspec
temp varying vector N_hair
temp varying vector V
temp varying vector norm_hair
temp varying color final_c
temp varying float Beta
temp varying vector NN
temp varying float Kajiya
temp varying float T_Dot_nL
temp varying vector S
temp varying vector nL
temp varying float darkening
temp varying vector LN
temp varying vector T
temp varying float Kspec
temp varying float T_Dot_e
temp varying color Cout
temp varying color Cdiff
temp varying float clump_darkening
temp uniform color SpecularColor
temp uniform float $1
temp varying float $2
temp varying float $3
temp varying float $4
temp uniform float $5
temp varying float $6
temp uniform float $7
temp uniform float $8
temp varying vector $9
temp varying vector $10
temp uniform vector $11
temp varying vector $12
temp uniform vector $13
temp uniform vector $14
const float $15 0
const float $16 1
const float $17 2
const float $18 0.299
const float $19 0.114
const float $20 -1
const float $21 0.587
global dPdv Oi Cl I L P Ci v Os
codesegment @1
	movvf            $13 $16
	addvvv           $13 $13 tipcolor
	divvvf           specularcolor $13 $17
	movvf            surface_normal $16
	movvf            clump_vect $15
@1
	normalize        T dPdv
	normalize        $12 I
	negvv            V $12
	movvf            Cspec $15
	movvf            Cdiff $15
	movff            Kspec Ks
	normalize        nSN surface_normal
	vcross           S nSN T
	vcross           N_hair T S
	vdot             $6 nSN T
	clampf           l $6 $15 $16
	movff            clump_darkening $16
	movff            T_Dot_nL $15
	movff            T_Dot_e $15
	movff            Alpha $15
	movff            Beta $15
	movff            Kajiya $15
	movff            darkening $16
	movff            nonspecular $15
	movvf            SpecularColor $16
	mulvvf           $12 nSN l
	subfff           $3 $16 l
	mulvvf           $9 N_hair $3
	addvvv           norm_hair $12 $9
	normalize        norm_hair norm_hair
	subfff           $8 end_spec spec_size_fade
	smoothstep       $6 end_spec $8 v
	subfff           $6 $16 $6
	addfff           $7 start_spec spec_size_fade
	smoothstep       $3 start_spec $7 v
	minf             $6 $3 $6
	mulfff           Kspec Kspec $6
	radians          $8 illum_width
@2
	illuminance2     P norm_hair $8 @3
	normalize        nL L
	vdot             T_Dot_nL T nL
	vdot             T_Dot_e T V
	acos             Alpha T_Dot_nL
	acos             Beta T_Dot_e
	mulfff           $6 T_Dot_nL T_Dot_e
	sin              $3 Alpha
	sin              $4 Beta
	maddfff          $6 $3 $4
	movff            Kajiya $6
	jleff            clump_dark_strength $15 @4
	mulvvf           $12 clump_vect $20
	normalize        $12 $12
	vdot             $6 nL $12
	clampf           $6 $6 $20 $15
	abs              $6 $6
	mulfff           $6 clump_dark_strength $6
	subfff           clump_darkening $16 $6
	jmp              @5
@4
	movff            clump_darkening $16
@5
	subfff           $8 $16 nonspecular
	mulvvf           $13 SpecularColor $8
	mulvvf           $12 $13 clump_darkening
	mulvvf           $9 Cl SPEC1
	divfff           $5 $16 roughness1
	pow              $4 Kajiya $5
	mulvvf           $9 $9 $4
	mulvvf           $10 Cl SPEC2
	divfff           $1 $16 roughness2
	pow              $2 Kajiya $1
	maddvvf          $9 $10 $2
	maddvvv          Cspec $12 $9
	movvv            Cout Cl
	normalize        LN L
	normalize        NN norm_hair
	vdot             $6 LN NN
	maxf             Atten $15 $6
	movvf            $12 Atten
	mulvvv           Cout Cout $12
	movvv            $9 Cout
	maddvvf          Cdiff $9 clump_darkening
	jmp              @2
@3
	clampf           darkening hair_col_var $15 $16
	mulvvf           $9 Cdiff Kd
	compv            $3 $9 $15
	mulfff           $3 $3 $18
	mulvvf           $10 Cdiff Kd
	compv            $4 $10 $16
	maddfff          $3 $4 $21
	mulvvf           $10 Cdiff Kd
	compv            $4 $10 $17
	maddfff          $3 $4 $19
	abs              $3 $3
	smoothstep       $3 var_fade_end var_fade_start $3
	mulfff           $3 $3 darkening
	subfff           darkening $16 $3
	mixv             $9 rootcolor tipcolor v
	mulvvf           final_c $9 darkening
	ambient          $9
	mulvvf           $9 $9 Ka
	mulvvf           $10 Cdiff Kd
	addvvv           $9 $9 $10
	addvvv           $9 $9 static_ambient
	mulvvv           $9 $9 final_c
	mulfff           $4 v Kspec
	mulvvf           $10 Cspec $4
	maddvvv          $9 $10 specularcolor
	movvv            Ci $9
	movvf            $14 $16
	movvf            $11 $15
	clampv           Ci Ci $11 $14
	movvv            Oi Os
	mulvvv           Ci Oi Ci
	return
