surface bumptest
param uniform float Ka 1
param uniform float Kd 1
param uniform float Km 0.25
global N I Ci Cs Oi Os P
temp vector $1
temp vector $2
temp vector $3
temp float $4
temp vector $5
temp uniform float $6
temp float $7
temp uniform float $8
temp uniform float $9
temp point PP
codesegment
	normalize    $1 N

	# simple fBm, 5 octs
	ptransform1  PP "shader" P
	movff        $7 0
	movff        $6 3
@1
	jeqff        $6 8 @2
	pow          $8 2 $6
	mulvvf       $3 PP $8
	noise3f      $4 $3
	pow          $9 0.5 $6
	maddfff      $7 $4 $9
	addfff       $6 $6 1
	jmp          @1
@2
	mulfff       $7 $7 Km
	abs          $7 $7
	maddvvf      P $1 $7
	calcnormal   $5 P
	normalize    $1 $5

	faceforward1 $1 $1 I
	diffuse      $2 $1
	ambient      $1
	mulvvf       $1 $1 Ka
	maddvvf      $1 $2 Kd
	mulvvv       Ci Cs $1
	movvv        Oi Os
	mulvvv       Ci Ci Oi
	return
