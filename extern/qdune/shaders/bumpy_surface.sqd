# this is just a bumpmap version of 'bumpy' displacement shader
surface bumpy_surface
param uniform float Ka 1
param uniform float Kd 1
param float Km 1
param string texturename ""
temp float amp
temp vector $1
temp vector $2
temp float $3
const string $4 ""
const float $5 0.5
const float $6 2
const float $7 1
global P N s t I Ci Cs Oi Os
codesegment
	jeqss				texturename $4 @1
	jeqff				Km 0 @1
	texturef		amp texturename s t
	subfff			amp amp $5
	mulfff			amp amp $6
	mulfff			amp amp Km
	normalize		$1 N
	mulvvf			$1 $1 amp
	addvvv			P P $1
	calcnormal	N P
@1

	normalize    $1 N
	faceforward1 $1 $1 I
	diffuse      $2 $1
	ambient      $1
	mulvvf       $1 $1 Ka
	maddvvf      $1 $2 Kd
	mulvvv       Ci Cs $1
	movvv        Oi Os
	mulvvv       Ci Ci Oi

	# pseudo light, hemi type from normal
	#normalize		$1 N
	#ycomp				$3 $1
	#addfff			$3 $3 $7
	#mulfff			$3 $3 $5
	#mulvvf			Ci Cs $3
	#movvv				Oi Os
	#mulvvv			Ci Ci Oi
	return
