# QDSLC version 0.0.1-alpha
surface clay
param uniform float Ka 1
param uniform float roughness 0.1
param uniform float Kd 0.7
temp varying float theta_r
temp varying float theta_i
temp varying float alpha
temp varying vector V_perp_N
temp varying color C
temp varying normal Nf
temp varying vector LN
temp varying float beta
temp varying float cos_theta_i
temp varying float B
temp varying float A
temp varying float sigma2
temp varying float nondiff
temp varying float cos_phi_diff
temp varying float $1
temp varying float $2
temp varying float $3
temp varying bool $4
temp varying vector $5
temp varying vector $6
temp varying vector $7
const float $8 0.5
const float $9 1
const float $10 0.09
const float $11 0
const float $12 0.33
const string $13 "__nondiffuse"
const float $14 1.5707963268
const float $15 0.45
global Ci Oi Cl I L N P Cs Os
codesegment
	normalize        $7 N
	faceforward1     Nf $7 I
	ambient          $7
	mulvvf           $7 $7 Ka
	normalize        $5 I
	negvv            $5 $5
	mulfff           sigma2 roughness roughness
	mulfff           $3 $8 sigma2
	addfff           $1 sigma2 $12
	divfff           $3 $3 $1
	subfff           A $9 $3
	mulfff           $3 $15 sigma2
	addfff           $1 sigma2 $10
	divfff           B $3 $1
	vdot             $3 $5 Nf
	acos             theta_r $3
	vdot             $3 $5 Nf
	mulvvf           $6 Nf $3
	subvvv           $6 $5 $6
	normalize        V_perp_N $6
	movvf            C $11
@1
	illuminance2     P Nf $14 @2
	movff            nondiff $11
	ifltff           $4 nondiff $9
	cond_push        $4
	normalize        LN L
	vdot             cos_theta_i LN Nf
	mulvvf           $6 Nf cos_theta_i
	subvvv           $6 LN $6
	normalize        $6 $6
	vdot             cos_phi_diff V_perp_N $6
	acos             theta_i cos_theta_i
	maxf             alpha theta_i theta_r
	minf             beta theta_i theta_r
	mulvvf           $6 Cl $9
	mulvvf           $6 $6 cos_theta_i
	maxf             $1 $11 cos_phi_diff
	mulfff           $1 B $1
	sin              $2 alpha
	mulfff           $1 $1 $2
	tan              $2 beta
	mulfff           $1 $1 $2
	addfff           $1 A $1
	maddvvf          C $6 $1
	cond_pop
	jmp              @1
@2
	movvv            $6 C
	mulvvf           $6 $6 Kd
	addvvv           $5 $7 $6
	mulvvv           Ci Cs $5
	movvv            Oi Os
	mulvvv           Ci Ci Oi
	return
