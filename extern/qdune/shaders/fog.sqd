# Original source:
# volume fog(float distance = 1;
#            color background = color(0.5, 0.5, 0.5);)
# {
# 	float d = 1 - exp(-length(I)/distance);
# 	Ci = mix(Ci, background, d);
# 	Oi = mix(Oi, color(1, 1, 1), d);
# }
volume fog
param float distance 1
param color background 0.5 0.5 0.5
temp float d
temp float $1
const color $2 1 1 1
global I Ci Oi
codesegment
	length		$1 I
	negff			$1 $1
	divfff		$1 $1 distance
	exp				$1 $1
	subfff		d 1 $1
	mixv			Ci Ci background d
	mixv			Oi Oi $2 d
	return
