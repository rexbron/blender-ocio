# QDSLC version 0.0.1-alpha
surface lensflare
param uniform float spotvarycolor 0.5
param uniform float rainbowintensity 0.03
param uniform float ringy 1
param uniform float rainbowwidth 0.2
param uniform float disky 3
param uniform float bloomfalloff 8
param uniform float bloony 1
param uniform float bloomstarry 0.75
param uniform float spotintensity 0.08
param uniform float rainbowradius 0.5
param uniform float starburstfalloff 3
param uniform float bloomnpoints 25
param uniform float intensity 1.0
param uniform float starburstradius 0.5
param uniform float bloomintensity 1
param uniform float seed 143
param uniform float bloomradius 0.5
param uniform float nspots 50
param uniform float blotty 1
param uniform float starburstnpoints 100
param uniform float starburstintensity 0.075
temp varying float star
temp varying point Pndc
temp varying vector axis
temp varying float radius
temp varying float brightness
temp varying vector Lvec
temp uniform float type
temp varying float int
temp varying float axisdist
temp uniform float halfangle
temp uniform point Pcorner0
temp varying float bright
temp varying float x1
temp uniform point Pcorner1
temp varying float bloom
temp varying float atten
temp uniform float lensfov
temp varying float x0
temp varying float dist
temp varying float radius_2
temp uniform float nrand
temp varying color clr
temp varying float radius_1
temp varying float x1_1
temp varying float x0_1
temp uniform float i
temp varying float dPndc
temp varying point cntr
temp varying color Cflare
temp uniform float alltypes
temp uniform float alongaxis
temp varying point Plight
temp uniform float aspect
temp uniform vector corner
temp varying float angle
temp varying float $1
temp varying float $2
temp varying vector $3
temp uniform vector $4
temp uniform vector $5
temp varying vector $6
temp uniform vector $7
temp varying float $8
temp uniform vector $9
temp uniform vector $10
temp varying vector $11
temp varying vector $12
temp uniform float $13
temp uniform float $14
temp varying float $15
temp varying float $16
temp varying float $17
temp uniform float $18
temp uniform float $19
temp varying float $20
temp uniform float $21
temp varying float $22
temp varying float $23
temp uniform bool $24
temp varying vector $25
temp uniform float $26
const float $27 0
const float $28 0.5
const string $29 "NDC"
const float $30 3
const vector $31 0.375 0 0.75
const float $32 5
const float $33 1
const vector $34 0 0 1
const float $35 1e-06
const float $36 6.28318530718
const vector $37 1 0 0
const float $38 20
const vector $39 0.5 0 0.5
const float $40 0.04
const string $41 "camera"
const vector $42 0.5 0 0.5
const vector $43 0.5 0.5 0
const vector $44 0 1 0
const vector $45 1 1 0
const vector $46 1 0.5 0
const vector $47 1 1 0
const vector $48 1 0 0
const float $49 -1.7
const string $50 "screen"
const float $51 2
const float $52 1.7
const float $53 0.05
const vector $54 0 0 1
const vector $55 1 1 0
const float $56 3.14159265359
const vector $57 0.5 0.5 0
const vector $58 0 0 1
const float $59 0.1
const float $60 0.2
const float $61 1.5707963268
const vector $62 0 0 0
global Ci Oi Cl L P Cs
codesegment
	movff            nrand $27
	movvf            Ci $27
	movvf            Oi $27
	ptransform2      Pcorner0 $29 $50 $62
	ptransform2      Pcorner1 $29 $50 $47
	xcomp            $18 Pcorner1
	xcomp            $14 Pcorner0
	subfff           $18 $18 $14
	ycomp            $14 Pcorner1
	ycomp            $13 Pcorner0
	subfff           $14 $14 $13
	divfff           $18 $18 $14
	abs              aspect $18
	ptransform2      corner $29 $41 $55
	normalize        $7 corner
	vdot             $18 $7 $58
	acos             halfangle $18
	mulfff           lensfov $51 halfangle
	ptransform1      $6 $29 P
	subvvv           $6 $6 $43
	mulvvf           Pndc $6 $51
	movvf3           $7 aspect $33 $27
	mulvvv           Pndc Pndc $7
	area             $17 Pndc
	sqrt             $17 $17
	maxf             dPndc $17 $35
	vtocurr          $7 $41 $54
@1
	illuminance2     P $7 $61 @2
	addvvv           $6 P L
	ptransform1      $6 $41 $6
	normalize        $6 $6
	zcomp            $17 $6
	acos             atten $17
	abs              $17 atten
	divfff           $14 lensfov $51
	divfff           $17 $17 $14
	smoothstep       $17 $33 $51 $17
	subfff           atten $33 $17
	mulfff           $17 atten intensity
	compv            $15 Cl $27
	compv            $16 Cl $33
	addfff           $15 $15 $16
	compv            $16 Cl $51
	addfff           $15 $15 $16
	mulfff           $17 $17 $15
	divfff           brightness $17 $30
	movvf            Cflare $27
	movff            nrand $27
	addvvv           $6 P L
	ptransform1      $6 $29 $6
	subvvv           $6 $6 $57
	mulvvf           Plight $6 $51
	movvf3           $7 aspect $33 $27
	mulvvv           Plight Plight $7
	subvvv           Lvec Plight Pndc
	xcomp            $17 Lvec
	ycomp            $15 Lvec
	atan2            $17 $15 $17
	addfff           angle $17 $56
	length           dist Lvec
	jleff            bloomintensity $27 @3
	sqrt             $17 brightness
	mulfff           $17 $17 $32
	addfff           nrand nrand $33
	cellnoise2f      $14 nrand seed
	mixf             $14 $60 bloomradius $14
	mulfff           radius $17 $14
	mulfff           $17 bloomnpoints angle
	divfff           $17 $17 $36
	pnoise1f         bloom $17 bloomnpoints
	mixf             bloom $28 bloom bloomstarry
	divfff           $17 dist radius
	smoothstep       $17 $27 $28 $17
	mixf             bloom $33 bloom $17
	mulfff           $17 radius bloom
	smoothstep       $17 $27 $17 dist
	subfff           $17 $33 $17
	pow              bloom $17 bloomfalloff
	divfff           $18 bloomintensity intensity
	mulfff           $17 bloom $18
	divfff           $17 $17 brightness
	movvf            $6 $17
	addvvv           Cflare Cflare $6
@3
	jleff            starburstintensity $27 @5
	sqrt             $15 brightness
	mulfff           $15 $15 $32
	addfff           nrand nrand $33
	cellnoise2f      $13 nrand seed
	mixf             $13 $60 starburstradius $13
	mulfff           radius_1 $15 $13
	mulfff           $15 starburstnpoints angle
	divfff           $15 $15 $36
	pnoise1f         star $15 starburstnpoints
	mulfff           $15 radius_1 star
	smoothstep       $15 $27 $15 dist
	subfff           $15 $33 $15
	pow              star $15 starburstfalloff
	divfff           $14 starburstintensity intensity
	mulfff           $15 star $14
	divfff           $15 $15 brightness
	movvf            $25 $15
	addvvv           Cflare Cflare $25
@5
	jleff            rainbowintensity $27 @7
	divfff           $13 rainbowintensity intensity
	mulfff           $16 brightness $13
	divfff           $1 dPndc rainbowradius
	divfff           $1 $1 rainbowwidth
	divfff           $2 dist rainbowradius
	subfff           $2 $2 $33
	divfff           $2 $2 rainbowwidth
	divfff           $22 $1 $51
	subfff           x0 $2 $22
	addfff           x1 x0 $1
	minf             $22 x1 $33
	maxf             $23 x0 $27
	subfff           $22 $22 $23
	divfff           $22 $22 $1
	maxf             $22 $27 $22
	spline1v         $11 $2 $42 $39 $31 $34 $44 $45 $46 $48 $37
	mulvvf           $3 $11 $22
	maddvvf          Cflare $3 $16
@7
	normalize        axis Plight
	movff            nrand $38
	movff            i $27
@9
	ifltff           $24 i nspots
	cjmpnot          $24 @10
	addfff           nrand nrand $33
	cellnoise2f      alongaxis nrand seed
	mixf             $26 $49 $52 alongaxis
	mulvvf           cntr axis $26
	distance         axisdist cntr Pndc
	addfff           nrand nrand $33
	cellnoise2f      $26 nrand seed
	pow              $26 $26 $51
	mixf             $26 $40 $59 $26
	distance         $2 cntr Plight
	mulfff           radius_2 $26 $2
	movvv            clr Cl
	cellnoise1v      $5 i
	movvf            $4 $28
	subvvv           $4 $5 $4
	mulvvf           $4 $4 spotvarycolor
	movvf            $10 $33
	addvvv           $10 $10 $4
	mulvvv           clr clr $10
	mulfff           $22 $51 radius_2
	subfff           bright $33 $22
	mulfff           bright bright bright
	addfff           $21 disky ringy
	addfff           $21 $21 blotty
	addfff           alltypes $21 bloony
	addfff           nrand nrand $33
	cellnoise2f      $21 nrand seed
	mulfff           type $21 alltypes
	movff            int $27
	jgeff            type disky @11
	divfff           $22 dPndc $51
	subfff           $22 axisdist $22
	divfff           $23 dPndc $51
	addfff           $23 axisdist $23
	filterstep2      $22 radius_2 $22 $23
	subfff           int $33 $22
	jmp              @12
@11
	addfff           $21 disky ringy
	jgeff            type $21 @13
	mulfff           $22 $53 axisdist
	addfff           $22 radius_2 $22
	divfff           $23 dPndc $51
	subfff           x0_1 axisdist $23
	addfff           x1_1 x0_1 dPndc
	minf             $23 x1_1 $22
	maxf             $20 x0_1 radius_2
	subfff           $23 $23 $20
	divfff           $23 $23 dPndc
	maxf             int $27 $23
	jmp              @14
@13
	addfff           $19 disky ringy
	addfff           $19 $19 blotty
	jgeff            type $19 @15
	smoothstep       $23 $27 radius_2 axisdist
	subfff           int $33 $23
	jmp              @16
@15
	smoothstep       $23 $27 radius_2 axisdist
	divfff           $20 dPndc $51
	subfff           $20 axisdist $20
	divfff           $8 dPndc $51
	addfff           $8 axisdist $8
	filterstep2      $20 radius_2 $20 $8
	subfff           int $23 $20
@16
@14
@12
	mulfff           $23 spotintensity bright
	mulvvf           $12 clr $23
	mulvvv           $12 $12 Cs
	maddvvf          Cflare $12 int
	addfff           i i $33
	jmp              @9
@10
	mulvvv           $12 Cflare Cl
	maddvvf          Ci $12 atten
	jmp              @1
@2
	movvf            $9 intensity
	mulvvv           Ci Ci $9
	return
