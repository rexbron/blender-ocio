# QDSLC version 0.0.1-alpha
volume smoke
param uniform float smokefreq 1
param uniform float lightdensity 1
param uniform float integend 100
param uniform float integstart 0
param uniform float stepsize 0.1
param uniform float smokevary 1
param uniform float opacdensity 1
param uniform float maxsteps 100
param uniform color scatter 1 1 1
param uniform float smokeoctaves 0
temp varying float d
temp varying point Psmoke_1
temp varying float fw
temp varying float dtau
temp varying point Psmoke
temp varying float fw_1
temp varying color li
temp varying float sum
temp varying float foglight
temp varying vector WIN
temp varying point pp
temp varying point pp_1
temp varying float end
temp uniform float amp
temp varying color lighttau
temp varying point Worigin
temp uniform float amp_1
temp varying point origin
temp uniform float i
temp varying color Ov
temp varying float sum_1
temp varying color Cv
temp varying vector IN
temp uniform float i_1
temp varying float tau
temp varying float last_dtau
temp varying color last_li
temp varying float ss
temp varying float foglight_1
temp varying bool $1
temp varying vector $2
temp varying float $3
temp varying vector $4
temp varying vector $5
temp varying vector $6
temp varying vector $7
temp varying vector $8
temp varying vector $9
temp varying vector $10
temp varying vector $11
temp uniform vector $12
temp varying vector $13
temp uniform vector $14
temp uniform vector $15
temp varying float $16
temp varying vector $17
temp uniform float $18
temp varying float $19
temp varying float $20
temp varying float $21
temp varying float $22
temp varying float $23
temp varying float $24
temp varying float $25
temp varying float $26
temp varying float $27
temp uniform float $28
temp uniform bool $29
temp uniform bool $30
temp varying bool $31
temp uniform bool $32
temp uniform bool $33
temp varying bool $34
const float $35 0
const float $36 1
const float $37 2
const string $38 "shader"
const float $39 0.5
const float $40 0.005
const float $41 0.0001
const float $42 0.2
const string $43 "__foglight"
const string $44 "current"
const float $45 -1
const float $46 0.01
const float $47 0.75
global I P Ci Oi Cl
codesegment
	subvvv           Worigin P I
	ptransform1      origin $38 Worigin
	randomf          $21
	mulfff           $21 $21 stepsize
	addfff           d integstart $21
	vtransform1      $7 $38 I
	normalize        IN $7
	vtransform2      WIN $38 $44 IN
	length           $21 I
	minf             $21 $21 integend
	subfff           end $21 $41
	subfff           $21 end d
	minf             ss stepsize $21
	mulvvf           $7 IN d
	addvvv           $7 origin $7
	mulvvf           $6 WIN d
	addvvv           $6 Worigin $6
	movvf            last_li $35
@1
	illuminance1     $6 @2
	movff            foglight $36
	ifgtff           $1 foglight $35
	cond_push        $1
	addvvv           last_li last_li Cl
	cond_pop
	jmp              @1
@2
	ifgtff           $29 smokeoctaves $35
	andgtff          $29 smokevary $35
	cond_push        $29
	mulvvf           Psmoke $7 smokefreq
	noise3f          $19 Psmoke
	mulfff           $19 $37 $19
	subfff           last_dtau $19 $36
	compv            $19 last_li $35
	compv            $20 last_li $36
	addfff           $19 $19 $20
	compv            $20 last_li $37
	addfff           $19 $19 $20
	ifgtff           $1 $19 $46
	cond_push        $1
	subfff           $18 smokeoctaves $36
	mulfff           $20 ss $37
	mulvvf           $4 Psmoke $37
	movff            amp $36
	movvv            pp $4
	movff            sum $35
	movff            fw $20
	movff            i $35
@3
	ifltff           $30 i $18
	cjmpnot          $30 @4
	noise3f          $3 pp
	mulfff           $3 $37 $3
	subfff           $3 $3 $36
	smoothstep       $27 $42 $47 fw
	subfff           $27 $36 $27
	mulfff           $3 $3 $27
	maddfff          sum amp $3
	mulfff           amp amp $39
	mulvvf           pp pp $37
	mulfff           fw fw $37
	addfff           i i $36
	jmp              @3
@4
	movff            $3 sum
	maddfff          last_dtau $39 $3
	cond_pop
	mulfff           $3 smokevary last_dtau
	smoothstep       last_dtau $45 $36 $3
	cond_else
	movff            last_dtau $39
	cond_pop
	movvf            Cv $35
	movvf            Ov $35
@5
	ifleff           $34 d end
	cjmpnot          $34 @6
	cond_push        $34
	subfff           $3 end d
	clampf           ss ss $40 $3
	addfff           d d ss
	mulvvf           $5 IN d
	addvvv           $5 origin $5
	mulvvf           $13 WIN d
	addvvv           $13 Worigin $13
	movvf            li $35
@7
	illuminance1     $13 @8
	movff            foglight_1 $36
	ifgtff           $31 foglight_1 $35
	cond_push        $31
	addvvv           li li Cl
	cond_pop
	jmp              @7
@8
	ifgtff           $32 smokeoctaves $35
	andgtff          $32 smokevary $35
	cond_push        $32
	mulvvf           Psmoke_1 $5 smokefreq
	noise3f          $25 Psmoke_1
	mulfff           $25 $37 $25
	subfff           dtau $25 $36
	compv            $25 li $35
	compv            $26 li $36
	addfff           $25 $25 $26
	compv            $26 li $37
	addfff           $25 $25 $26
	ifgtff           $31 $25 $46
	cond_push        $31
	subfff           $28 smokeoctaves $36
	mulfff           $26 ss $37
	mulvvf           $10 Psmoke_1 $37
	movff            amp_1 $36
	movvv            pp_1 $10
	movff            sum_1 $35
	movff            fw_1 $26
	movff            i_1 $35
@9
	ifltff           $33 i_1 $28
	cjmpnot          $33 @10
	noise3f          $24 pp_1
	mulfff           $24 $37 $24
	subfff           $24 $24 $36
	smoothstep       $22 $42 $47 fw_1
	subfff           $22 $36 $22
	mulfff           $24 $24 $22
	maddfff          sum_1 amp_1 $24
	mulfff           amp_1 amp_1 $39
	mulvvf           pp_1 pp_1 $37
	mulfff           fw_1 fw_1 $37
	addfff           i_1 i_1 $36
	jmp              @9
@10
	movff            $24 sum_1
	maddfff          dtau $39 $24
	cond_pop
	mulfff           $24 smokevary dtau
	smoothstep       dtau $45 $36 $24
	cond_else
	movff            dtau $39
	cond_pop
	mulfff           $24 opacdensity ss
	divfff           $24 $24 $37
	addfff           $22 dtau last_dtau
	mulfff           tau $24 $22
	mulfff           $24 lightdensity ss
	divfff           $24 $24 $37
	mulvvf           $8 li dtau
	mulvvf           $9 last_li last_dtau
	addvvv           $8 $8 $9
	mulvvf           lighttau $8 $24
	maddvvf          Cv lighttau $36
	negff            $24 tau
	mulvvf           $11 scatter $24
	compv            $22 $11 $35
	exp              $22 $22
	compv            $23 $11 $36
	exp              $23 $23
	compv            $16 $11 $37
	exp              $16 $16
	movvf3           $8 $22 $23 $16
	movvf            $15 $36
	subvvv           $9 $15 $8
	maddvvf          Ov $9 $36
	movff            last_dtau dtau
	movvv            last_li li
	cond_pop
	jmp              @5
@6
	movvf            $12 $36
	subvvv           $2 $12 Ov
	mulvvv           $2 $2 Ci
	addvvv           Ci Cv $2
	movvf            $14 $36
	subvvv           $17 $14 Ov
	mulvvv           $17 $17 Oi
	addvvv           Oi Ov $17
	return
