# QDSLC version 0.0.1-alpha
light uberlight
param uniform float cutoff 1000000.0
param uniform float cuton 0.01
param uniform float wedge 0.1
param uniform string lighttype "spot"
param uniform float sheary 0
param uniform float height 1
param uniform float intensity 1
param uniform float raytraceshadow 0
param uniform float nshadowrays 1
param uniform float __nondiffuse 0
param uniform float blockerround 1
param uniform float shadowblur 0.01
param uniform string shadowmap ""
param uniform float blockerhedge 0.1
param uniform string slidename ""
param uniform float blockerwidth 1
param uniform float width 1
param uniform float blockerheight 1
param uniform float noisefreq 4
param uniform float maxintensity 1
param uniform float blockerwedge 0.1
param uniform float parallelrays 0
param uniform vector shadowcheat 0.0 0.0 0.0
param uniform float __foglight 1
param uniform float falloff 0
param uniform float falloffdist 1
param uniform string blockercoords ""
param uniform color shadowcolor 0 0 0
param uniform float beamdistribution 0
param uniform float hedge 0.1
param uniform float shearx 0
param varying float __nonspecular 0
param uniform color lightcolor 1 1 1
param uniform float noiseamp 0
param uniform float shadownsamps 16
param uniform float nonspecular 0
param uniform float nearedge 0
param uniform float roundness 1
param uniform float shadowbias 0.01
param uniform vector noiseoffset 0 0 0
param uniform float faredge 0
temp varying point shadoworigin
temp varying point Pb2
temp varying vector axis
temp varying float unoccluded_1
temp varying float re
temp varying point Pb1
temp varying point Pslide
temp varying float y_1
temp varying float Pz
temp varying vector Vlight
temp varying float yslide
temp varying float r_2
temp varying float atten
temp varying float x_1
temp varying point Pplane
temp varying float q_1
temp varying point from
temp varying float s
temp varying float xslide
temp varying float atten_1
temp uniform float maxradius
temp varying float q_3
temp varying float re_1
temp varying float y
temp varying float q_2
temp varying float beta
temp varying float x
temp varying float r_3
temp varying float r
temp varying float PLlen
temp varying float result
temp varying float unoccluded
temp varying float q
temp uniform float angle
temp varying float n
temp varying float zslide
temp varying point PL
temp varying float result_1
temp varying float r_1
temp varying color lcol
temp uniform float $1
temp varying vector $2
temp varying float $3
temp varying vector $4
temp varying vector $5
temp varying vector $6
temp varying vector $7
temp varying float $8
temp varying float $9
temp varying vector $10
temp varying float $11
temp varying float $12
temp varying float $13
temp uniform float $14
temp uniform float $15
temp uniform float $16
temp uniform float $17
temp varying float $18
temp uniform float $19
temp varying float $20
temp varying float $21
temp varying float $22
temp uniform float $23
temp varying float $24
temp varying float $25
temp varying bool $26
temp uniform bool $27
temp varying bool $28
temp uniform float $29
temp varying float $30
temp varying float $31
temp varying bool $32
temp uniform float $33
temp varying bool $34
temp varying float $35
temp uniform vector $36
temp uniform float $37
const float $38 0
const float $39 1.0
const float $40 1.4142136
const string $41 "omni"
const string $42 ""
const float $43 2
const float $44 1e-06
const vector $45 0 0 0
const float $46 1.5707963268
const vector $47 1 1 0
const string $48 "blur"
const string $49 "arealight"
const string $50 "samples"
const float $51 0.5
const vector $52 0 0 0
const float $53 0.9999
const string $54 "shader"
const float $55 3.14159265359
const string $56 "bias"
const string $57 "spot"
const vector $58 0 0 1
const float $59 -1
global Ps L Cl
codesegment @1
	vtocurr          shadowcheat $54 $45
@1
	ptransform1      PL $54 Ps
	ptocurr          from $54 $52
	vtocurr          $36 $54 $58
	normalize        axis $36
	jness            lighttype $57 @2
	addfff           $15 width wedge
	abs              $17 shearx
	addfff           $15 $15 $17
	addfff           $17 height hedge
	abs              $16 sheary
	addfff           $17 $17 $16
	maxf             $15 $17 $15
	mulfff           maxradius $40 $15
	atan1            angle maxradius
	jmp              @3
@2
	jness            lighttype $49 @4
	movff            angle $46
	jmp              @5
@4
	movff            angle $55
@5
@3
	movff            __nonspecular nonspecular
	illuminate2      from axis angle
	movff            atten $39
	movvv            lcol lightcolor
	divfff           $15 maxintensity intensity
	movff            atten_1 $39
	length           PLlen PL
	jness            lighttype $57 @6
	zcomp            Pz PL
	jmp              @7
@6
	movff            Pz PLlen
@7
	subfff           $17 cuton nearedge
	smoothstep       $8 $17 cuton Pz
	mulfff           atten_1 atten_1 $8
	addfff           $17 cutoff faredge
	smoothstep       $8 cutoff $17 Pz
	subfff           $8 $39 $8
	mulfff           atten_1 atten_1 $8
	jeqff            falloff $38 @8
	ifgtff           $26 PLlen falloffdist
	cond_push        $26
	divfff           $8 falloffdist PLlen
	pow              $8 $8 falloff
	mulfff           atten_1 atten_1 $8
	cond_else
	divfff           $17 $39 $15
	log              s $17
	negff            $17 falloff
	divfff           beta $17 s
	divfff           $8 PLlen falloffdist
	pow              $8 $8 beta
	mulfff           $8 s $8
	exp              $8 $8
	mulfff           $8 $15 $8
	mulfff           atten_1 atten_1 $8
	cond_pop
@8
	ifness           $27 lighttype $41
	andgtff          $27 beamdistribution $38
	cond_push        $27
	normalize        $7 PL
	zcomp            $8 $7
	pow              $8 $8 beamdistribution
	mulfff           atten_1 atten_1 $8
	cond_pop
	jness            lighttype $57 @10
	addfff           $17 height hedge
	addfff           $16 width wedge
	movvf            $5 Pz
	divvvv           $6 PL $5
	movvf3           $4 shearx sheary $38
	subvvv           $6 $6 $4
	movff            result $38
	xcomp            $12 $6
	abs              x $12
	ycomp            $12 $6
	abs              y $12
	ifneff           $28 x $38
	orneff           $28 y $38
	cond_push        $28
	jgeff            roundness $44 @12
	smoothstep       $12 width $16 x
	subfff           $12 $39 $12
	smoothstep       $13 height $17 y
	subfff           $13 $39 $13
	mulfff           $12 $12 $13
	subfff           result $39 $12
	jmp              @13
@12
	jleff            roundness $53 @14
	mulfff           $14 width height
	mulfff           $13 height x
	mulfff           $24 $13 $13
	mulfff           $25 width y
	mulfff           $22 $25 $25
	addfff           $25 $24 $22
	sqrt             $25 $25
	divfff           q $14 $25
	mulfff           $23 $16 $17
	mulfff           $25 $17 x
	mulfff           $22 $25 $25
	mulfff           $9 $16 y
	mulfff           $20 $9 $9
	addfff           $9 $22 $20
	sqrt             $9 $9
	divfff           r $23 $9
	smoothstep       result q r $39
	jmp              @15
@14
	divfff           re $43 roundness
	mulfff           $33 width height
	divfff           $9 $59 re
	mulfff           $20 height x
	pow              $20 $20 re
	mulfff           $21 width y
	pow              $21 $21 re
	addfff           $20 $20 $21
	pow              $9 $20 $9
	mulfff           q_1 $33 $9
	mulfff           $33 $16 $17
	divfff           $9 $59 re
	mulfff           $20 $17 x
	pow              $20 $20 re
	mulfff           $21 $16 y
	pow              $21 $21 re
	addfff           $20 $20 $21
	pow              $9 $20 $9
	mulfff           r_1 $33 $9
	smoothstep       result q_1 r_1 $39
@15
@13
	cond_pop
	movff            $22 result
	subfff           $22 $39 $22
	mulfff           atten_1 atten_1 $22
@10
	movff            $22 atten_1
	mulfff           atten atten $22
	jeqss            slidename $42 @16
	addfff           $33 width wedge
	addfff           $29 height hedge
	movvf3           $10 $33 $29 $39
	divvvv           Pslide PL $10
	zcomp            zslide Pslide
	xcomp            $22 Pslide
	mulfff           $22 $51 $22
	divfff           $22 $22 zslide
	addfff           xslide $51 $22
	ycomp            $22 Pslide
	mulfff           $22 $51 $22
	divfff           $22 $22 zslide
	subfff           yslide $51 $22
	#texturev         $10 slidename xslide yslide
	mulvvv           lcol lcol $10
@16
	ifgtff           $32 atten $38
	cond_push        $32
	jleff            noiseamp $38 @18
	addvvv           $10 PL noiseoffset
	mulvvf           $10 $10 noisefreq
	mulvvv           $10 $10 $47
	noise3f          n $10
	subfff           $22 n $51
	mulfff           $22 noiseamp $22
	addfff           $22 $51 $22
	smoothstep       n $38 $39 $22
	mulfff           atten atten n
@18
	movff            unoccluded $39
	jeqss            shadowmap $42 @20
	shadow           $22 shadowmap Ps $48 shadowblur $50 shadownsamps $56 shadowbias
	subfff           $22 $39 $22
	mulfff           unoccluded unoccluded $22
@20
	jneff            parallelrays $38 @22
	movvv            shadoworigin from
	jmp              @23
@22
	xcomp            $22 PL
	ycomp            $9 PL
	movvf3           $10 $22 $9 cuton
	ptocurr          shadoworigin $54 $10
@23
	jeqss            blockercoords $42 @24
	movff            unoccluded_1 $39
	ptransform1      Pb1 blockercoords Ps
	ptransform1      Pb2 blockercoords shadoworigin
	zcomp            $22 Pb2
	zcomp            $9 Pb1
	mulfff           $22 $22 $9
	ifltff           $32 $22 $38
	cond_push        $32
	subvvv           Vlight Pb1 Pb2
	zcomp            $22 Pb1
	zcomp            $9 Vlight
	divfff           $22 $22 $9
	mulvvf           $10 Vlight $22
	subvvv           Pplane Pb1 $10
	addfff           $33 blockerheight blockerhedge
	addfff           $29 blockerwidth blockerwedge
	movff            result_1 $38
	xcomp            $20 Pplane
	abs              x_1 $20
	ycomp            $20 Pplane
	abs              y_1 $20
	ifneff           $34 x_1 $38
	orneff           $34 y_1 $38
	cond_push        $34
	jgeff            blockerround $44 @26
	smoothstep       $20 blockerwidth $29 x_1
	subfff           $20 $39 $20
	smoothstep       $21 blockerheight $33 y_1
	subfff           $21 $39 $21
	mulfff           $20 $20 $21
	subfff           result_1 $39 $20
	jmp              @27
@26
	jleff            blockerround $53 @28
	mulfff           $19 blockerwidth blockerheight
	mulfff           $21 blockerheight x_1
	mulfff           $18 $21 $21
	mulfff           $11 blockerwidth y_1
	mulfff           $30 $11 $11
	addfff           $11 $18 $30
	sqrt             $11 $11
	divfff           q_2 $19 $11
	mulfff           $1 $29 $33
	mulfff           $11 $33 x_1
	mulfff           $30 $11 $11
	mulfff           $31 $29 y_1
	mulfff           $35 $31 $31
	addfff           $31 $30 $35
	sqrt             $31 $31
	divfff           r_2 $1 $31
	smoothstep       result_1 q_2 r_2 $39
	jmp              @29
@28
	divfff           re_1 $43 blockerround
	mulfff           $37 blockerwidth blockerheight
	divfff           $31 $59 re_1
	mulfff           $35 blockerheight x_1
	pow              $35 $35 re_1
	mulfff           $3 blockerwidth y_1
	pow              $3 $3 re_1
	addfff           $35 $35 $3
	pow              $31 $35 $31
	mulfff           q_3 $37 $31
	mulfff           $37 $29 $33
	divfff           $31 $59 re_1
	mulfff           $35 $33 x_1
	pow              $35 $35 re_1
	mulfff           $3 $29 y_1
	pow              $3 $3 re_1
	addfff           $35 $35 $3
	pow              $31 $35 $31
	mulfff           r_3 $37 $31
	smoothstep       result_1 q_3 r_3 $39
@29
@27
	cond_pop
	movff            $30 result_1
	mulfff           unoccluded_1 unoccluded_1 $30
	cond_pop
	movff            $30 unoccluded_1
	mulfff           unoccluded unoccluded $30
@24
	mixv             lcol shadowcolor lcol unoccluded
	subfff           $30 $39 __nonspecular
	mulfff           $30 unoccluded $30
	subfff           __nonspecular $39 $30
	cond_pop
	mulfff           $30 atten intensity
	mulvvf           Cl lcol $30
	jeqff            parallelrays $38 @30
	subvvv           $2 Ps from
	length           $30 $2
	mulvvf           L axis $30
@30
	end_illuminate
	return
